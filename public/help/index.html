<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ajuda — Manual do Sistema</title>
    <style>
      body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:#f6f8fa; color:#0b1324 }
      .container { max-width:1000px; margin:28px auto; padding:24px; background:white; border-radius:10px; box-shadow:0 6px 30px rgba(10,20,40,0.08) }
      h1 { margin-top:0 }
      pre { white-space:pre-wrap; word-wrap:break-word }
      .meta { color:#6b7280; font-size:0.95rem; margin-bottom:12px }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Ajuda — Manual do Usuário</h1>
      <div class="meta">Manual interativo — carregando conteúdo...</div>
      <div id="content">Carregando...</div>
    </div>

    <script src="marked.min.js"></script>
    <script>
      // Simple markdown renderer (supports headings, paragraphs, lists, links, images, code blocks)
      function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
      function renderMarkdown(md){
        const lines = md.replace(/\r\n/g,'\n').split('\n');
        let out = '';
        let inList = false;
        let inCode = false;
        for(let i=0;i<lines.length;i++){
          let line = lines[i];
          if(line.startsWith('```')){ inCode = !inCode; out += inCode ? '<pre><code>' : '</code></pre>'; continue; }
          if(inCode){ out += escapeHtml(line)+'\n'; continue; }
          if(/^#{1,6}\s/.test(line)){
            const m = line.match(/^(#{1,6})\s+(.*)$/);
            out += `<h${m[1].length}>${m[2]}</h${m[1].length}>`;
            continue;
          }
          if(/^!\[.*\]\(.*\)/.test(line)){
            const m = line.match(/^!\[(.*)\]\((.*)\)/);
            out += `<p><img src="${m[2]}" alt="${m[1]}" style="max-width:100%"/></p>`; continue;
          }
          if(/^\[.*\]\(.*\)/.test(line)){
            const m = line.match(/^\[(.*)\]\((.*)\)/);
            out += `<p><a href="${m[2]}">${m[1]}</a></p>`; continue;
          }
          if(/^\s*[-*+]\s+/.test(line)){
            if(!inList){ inList = true; out += '<ul>'; }
            out += `<li>${line.replace(/^\s*[-*+]\s+/,'')}</li>`;
            const next = lines[i+1]||'';
            if(!/^\s*[-*+]\s+/.test(next)){ inList = false; out += '</ul>'; }
            continue;
          }
          if(line.trim()===''){ out += '<p></p>'; continue; }
          out += `<p>${line}</p>`;
        }
        return out;
      }

      (function(){
        fetch('/help/USER_MANUAL.md')
          .then(function(r){ if(!r.ok) throw new Error('HTTP '+r.status); return r.text(); })
          .then(function(md){
            var content = document.getElementById('content');
            try{
              if(window.marked && typeof window.marked.parse === 'function'){
                content.innerHTML = window.marked.parse(md);
              } else {
                content.innerHTML = renderMarkdown(md);
              }
            } catch(e){ content.textContent = md; }
          })
          .catch(function(e){ document.getElementById('content').textContent = 'Erro ao carregar manual: '+e; });
      })();
    </script>
  </body>
</html>
